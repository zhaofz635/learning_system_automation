name: Textbook Analysis Pipeline

on:
  workflow_dispatch:
    inputs:
      student_id:
        description: '学生ID (如 test001)'
        required: true
        type: string
      score:
        description: '测试成绩 (0-5分)'
        required: true
        type: string
      cognitive_load:
        description: '认知负荷评分 (1-5分，逗号分隔)'
        required: true
        type: string

jobs:
  analyze:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    env:
      NLTK_DATA: /tmp/nltk_data  # 全局设置 NLTK_DATA
    
    steps:
      # 1. 检出代码
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
    
      # 2. 设置Python环境
      - name: Set up Python 3.9
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
    
      # 3. 安装依赖
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install --force-reinstall -r requirements.txt
          python -c "import nltk; print('✅ nltk 版本:', nltk.__version__)" || { echo "❌ nltk 安装失败"; exit 1; }
          python -c "import nltk; nltk.download('punkt', download_dir='/tmp/nltk_data')" || { echo "❌ nltk punkt 下载失败"; exit 1; }
          ls -la /tmp/nltk
