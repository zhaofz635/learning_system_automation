name: Run Textbook Analysis

on:
  # 允许通过 API 手动触发
  workflow_dispatch:
    inputs:
      student_id:
        description: 'Student ID'
        required: true
      score:
        description: 'Score'
        required: true
      cognitive_load:
        description: 'Cognitive Load (comma separated)'
        required: true

jobs:
  analyze:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas numpy joblib nltk scikit-learn requests

    - name: Create scores.json and cognitive_load.json from inputs
      run: |
        echo "[{\"student_id\": ${{ inputs.student_id }}, \"score\": ${{ inputs.score }}}]" > scores.json
        echo "[{\"student_id\": ${{ inputs.student_id }}, \"responses\": [${{ inputs.cognitive_load }}]}]" > cognitive_load.json

    - name: Run Python Script
      env:
        MINIMAX_API_KEY: ${{ secrets.MINIMAX_API_KEY }}  # 将你的密钥存为 GitHub Secret
      run: |
        python textbook_difficulty_system.py \
          --cognitive_load cognitive_load.json \
          --scores scores.json \
          --textbook textbook.json \
          --output results.json

    # 后续步骤：将 results.json 的内容写回 Google Sheets
    # 这需要使用 Google Sheets API，比较复杂，此处省略
    # 你可以手动运行 "ImportJSON" 脚本来完成这一步
